# AG-UI BI Tool: Supabase Integration Plan

This document outlines the high level steps required to connect the AG-UI Business Intelligence tool to a Supabase database. Supabase will act as a managed PostgreSQL back end for storing and querying business data such as sales metrics.

## 1. Prerequisites

1. A Supabase project with database credentials (URL, anon/public keys, service role key).
2. Network access from the AG-UI BI Tool server to Supabase APIs.
3. The `@supabase/supabase-js` package installed in the server project (already listed in the Dojo package). If missing, add it to `ag-ui-bi-tool`.
4. Environment variables configured for Supabase credentials.

## 2. Server Side Integration

1. **Install Dependency**
   ```bash
   npm install @supabase/supabase-js
   ```
2. **Create a Supabase Client**
   In `ag-ui-bi-tool/src/server` create a module `supabaseClient.ts` that exports a Supabase client using the project URL and service role key.
3. **Implement a Data Connector**
   - Add a `SupabaseConnector` class that exposes methods to run SQL queries and return results.
   - Use the Supabase client's `rpc` or `from` methods to execute queries.
4. **Hook Into Existing Agent Logic**
   - Update data source selection logic to include Supabase as an option.
   - Translate natural language queries into SQL that targets Supabase tables.
5. **Handle Authentication**
   - Use service role key for server-side operations.
   - For client-originating requests, optionally use user session tokens generated by Supabase Auth.

## 3. Frontend Considerations

1. Expose Supabase as a selectable data source in the UI.
2. Allow users to specify tables or schemas they want to analyze.
3. Display connection status and query errors returned by Supabase.

## 4. Security

1. Store Supabase keys in environment variables, never in the repository.
2. Use Row Level Security policies in Supabase to restrict data access.
3. If end users authenticate with Supabase, use their session token when querying.

## 5. Example Query Flow

1. User selects Supabase as the data source.
2. Natural language query is parsed and translated to SQL.
3. Supabase connector runs the SQL via the API.
4. Results are fed back to the agent for analysis and visualization.

## 6. Next Steps

1. Prototype with a small Supabase table containing sales data.
2. Build automated tests for Supabase connector functions.
3. Monitor query performance and adjust indexes in Supabase as data grows.

